<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.11.0">
<title>Subvenciones en Euskadi | Subvenciones Euskadi</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,alt,wide.bb950bfd.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,alt,wide.bb950bfd.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.5890f157.js">
<link rel="modulepreload" href="./_observablehq/runtime.ad036670.js">
<link rel="modulepreload" href="./_observablehq/stdlib.14bb5491.js">
<link rel="modulepreload" href="./_import/components/charts/yearlyPlot.0a20d088.js">
<link rel="modulepreload" href="./_import/components/charts/dailyPlot.078a2d95.js">
<link rel="modulepreload" href="./_import/components/charts/grantsByConvenerPlot.876afdb9.js">
<link rel="modulepreload" href="./_import/components/inputs/grantSearch.c9efa09f.js">
<link rel="modulepreload" href="./_import/components/inputs/grantTable.beff949e.js">
<link rel="modulepreload" href="./_import/components/inputs/yearSelect.c04b7b7b.js">
<link rel="modulepreload" href="./_import/components/display.fcfd1cfa.js">
<link rel="modulepreload" href="./_import/components/helpers.7480c0b4.js">
<link rel="modulepreload" href="./_import/components/dictionary.1fe078c9.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="./_import/components/charts/sparkbar.e2c4d429.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.84591b8f.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<link rel="icon" href="./_file/assets/images/favicon.24c4c70f.ico" type="image/x-icon" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.5890f157.js";
import {registerFile} from "./_observablehq/stdlib.14bb5491.js";

registerFile("./data/config.json", {"name":"./data/config.json","mimeType":"application/json","path":"./_file/data/config.d54278d0.json","lastModified":1730224351969,"size":87});
registerFile("./data/granted-benefits_2015.json", {"name":"./data/granted-benefits_2015.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2015.1dcd2e31.json","lastModified":1730221358028,"size":17805734});
registerFile("./data/granted-benefits_2016.json", {"name":"./data/granted-benefits_2016.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2016.a2c04995.json","lastModified":1730221392314,"size":20703077});
registerFile("./data/granted-benefits_2017.json", {"name":"./data/granted-benefits_2017.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2017.82459ff4.json","lastModified":1730221466775,"size":36088455});
registerFile("./data/granted-benefits_2018.json", {"name":"./data/granted-benefits_2018.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2018.047965ff.json","lastModified":1730221562028,"size":40203345});
registerFile("./data/granted-benefits_2019.json", {"name":"./data/granted-benefits_2019.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2019.198e4979.json","lastModified":1730221756116,"size":69935248});
registerFile("./data/granted-benefits_2020.json", {"name":"./data/granted-benefits_2020.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2020.7d22d1ba.json","lastModified":1730221816548,"size":28408934});
registerFile("./data/granted-benefits_2021.json", {"name":"./data/granted-benefits_2021.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2021.14a013ff.json","lastModified":1730221909958,"size":41538707});
registerFile("./data/granted-benefits_2022.json", {"name":"./data/granted-benefits_2022.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2022.9e3cd3cf.json","lastModified":1730221912096,"size":1115052});
registerFile("./data/granted-benefits_2023.json", {"name":"./data/granted-benefits_2023.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2023.cca5bf6e.json","lastModified":1730221027908,"size":2937847});
registerFile("./data/granted-benefits_2024.json", {"name":"./data/granted-benefits_2024.json","mimeType":"application/json","path":"./_file/data/granted-benefits_2024.d2de93c8.json","lastModified":1730221028347,"size":124185});

define({id: "3c93ed0c", mode: "inline", inputs: ["config","display"], body: async (config,display) => {
display(await(
Math.min(...config.years)
))
}});

define({id: "f8b425a7", mode: "inline", inputs: ["config","display"], body: async (config,display) => {
display(await(
Math.max(...config.years)
))
}});

define({id: "72e644b8", outputs: ["YearlyPlot","DailyPlot","GrantsByConvenerPlot","GrantSearch","GrantTable","YearSelect","Display","hp","dict"], body: async () => {
const [{YearlyPlot}, {DailyPlot}, {GrantsByConvenerPlot}, {GrantSearch}, {GrantTable}, {YearSelect}, {Display}, hp, dict] = await Promise.all([import("./_import/components/charts/yearlyPlot.0a20d088.js"), import("./_import/components/charts/dailyPlot.078a2d95.js"), import("./_import/components/charts/grantsByConvenerPlot.876afdb9.js"), import("./_import/components/inputs/grantSearch.c9efa09f.js"), import("./_import/components/inputs/grantTable.beff949e.js"), import("./_import/components/inputs/yearSelect.c04b7b7b.js"), import("./_import/components/display.fcfd1cfa.js"), import("./_import/components/helpers.7480c0b4.js"), import("./_import/components/dictionary.1fe078c9.js")]);


return {YearlyPlot,DailyPlot,GrantsByConvenerPlot,GrantSearch,GrantTable,YearSelect,Display,hp,dict};
}});

define({id: "6a57379e", inputs: ["FileAttachment"], outputs: ["config","responses"], body: async (FileAttachment) => {
const config = await FileAttachment("./data/config.json").json();
const responses = {}
responses['2015'] = await FileAttachment("./data/granted-benefits_2015.json").json();
responses['2016'] = await FileAttachment("./data/granted-benefits_2016.json").json();
responses['2017'] = await FileAttachment("./data/granted-benefits_2017.json").json();
responses['2018'] = await FileAttachment("./data/granted-benefits_2018.json").json();
responses['2019'] = await FileAttachment("./data/granted-benefits_2019.json").json();
responses['2020'] = await FileAttachment("./data/granted-benefits_2020.json").json();
responses['2021'] = await FileAttachment("./data/granted-benefits_2021.json").json();
responses['2022'] = await FileAttachment("./data/granted-benefits_2022.json").json();
responses['2023'] = await FileAttachment("./data/granted-benefits_2023.json").json();
responses['2024'] = await FileAttachment("./data/granted-benefits_2024.json").json();
return {config,responses};
}});

define({id: "0357b364", inputs: ["config","responses"], outputs: ["years","grantedBenefits"], body: (config,responses) => {
// process `responses` by year
let years = config.years//.map( y => y.toString() ) 
let grantedBenefits = [] 

// gather all grants
console.log(years)
for (const i in years) {
  const year = years[i]
  grantedBenefits = grantedBenefits.concat(responses[year]['granted-benefits'])
}
return {years,grantedBenefits};
}});

define({id: "7a56f76d", inputs: ["grantedBenefits","years"], outputs: ["stats"], body: (grantedBenefits,years) => {
// calculate stats
let stats = {}
stats['total_grant_count'] = grantedBenefits.length
stats['grant_count_per_year'] = years.map(function(year) {
  return {
    year: year,
    value: grantedBenefits.filter(grant => grant.year == year).length
  }
})
stats['total_grant_amount'] = grantedBenefits.reduce((accumulator, grant) => accumulator + grant.granted_amount, 0)
stats['grant_amount_per_year'] = years.map(function (year) {
  return {
    year,
    value: grantedBenefits.filter(grant => grant.year == year).reduce((accumulator, grant) => accumulator + grant.granted_amount, 0)
  }
})

return {stats};
}});

define({id: "ec6a8080", body: () => {
//years = config.years.map( y => y.toString() ) 
}});

define({id: "6709c38e", inputs: ["d3","grantedBenefits"], outputs: ["grantsByConvener","grantsByDay"], body: (d3,grantedBenefits) => {
// Data processing
const grantsByConvener = d3
  .rollups(grantedBenefits, v => d3.sum(v, d => d.granted_amount), d => d.convener_name)
  .map(([name, value]) => ({name, value}))
  .sort((a, b) => d3.descending(a.value, b.value));

const grantsByDay = d3
  .rollups(grantedBenefits, v => d3.sum(v, d => d.granted_amount), d => new Date(d.granted_date))
  .map(([date, value]) => ({date, value}))
return {grantsByConvener,grantsByDay};
}});

define({id: "210898ec", inputs: ["YearSelect","years","Inputs","Generators"], outputs: ["yearSelectInput","yearSelection"], body: (YearSelect,years,Inputs,Generators) => {
const yearSelectInput = YearSelect(years, Inputs);
const yearSelection = Generators.input(yearSelectInput);
return {yearSelectInput,yearSelection};
}});

define({id: "72480863", inputs: ["GrantSearch","grantedBenefits","Inputs","Generators"], outputs: ["searchInput","filteredData"], body: (GrantSearch,grantedBenefits,Inputs,Generators) => {
// Search Input
const searchInput = GrantSearch(grantedBenefits, Inputs);
let filteredData = Generators.input(searchInput);
return {searchInput,filteredData};
}});

define({id: "dfbbdedb", inputs: ["GrantTable","filteredData","Inputs","Generators"], outputs: ["grantTableInput","tableSelection"], body: (GrantTable,filteredData,Inputs,Generators) => {
//Table Input
const grantTableInput = GrantTable(filteredData, Inputs)
const tableSelection = Generators.input(grantTableInput);
return {grantTableInput,tableSelection};
}});

define({id: "382cd89f", mode: "inline", inputs: ["hp","d3","grantedBenefits","display"], body: async (hp,d3,grantedBenefits,display) => {
display(await(
hp.numberToLocaleString(d3.sum(grantedBenefits, d => d.granted_amount), 'millones')
))
}});

define({id: "5c8843bf", mode: "inline", inputs: ["hp","grantedBenefits","display"], body: async (hp,grantedBenefits,display) => {
display(await(
hp.numberToLocaleString(grantedBenefits.length)
))
}});

define({id: "83f38939", mode: "inline", inputs: ["resize","GrantsByConvenerPlot","grantsByConvener","display"], body: async (resize,GrantsByConvenerPlot,grantsByConvener,display) => {
display(await(
resize((width) =>
        GrantsByConvenerPlot(grantsByConvener, {
          width,
          marginBottom: 35,
          marginLeft: 0,
          marginRight: 5,
          x: {
            label: "Millones €",
            transform: (d) => d / 1000000,
          },
          y: {
            padding: 0.2,
            label: "Organismo",
          },
        })
      )
))
}});

define({id: "613fcbe3", mode: "inline", inputs: ["resize","YearlyPlot","stats","display"], body: async (resize,YearlyPlot,stats,display) => {
display(await(
resize((width) =>
        YearlyPlot(stats.grant_amount_per_year, {
          width,
          marginRight: 0,
          marginLeft: 0,
          y: {
            label: "Millones €",
            transform: (d) => d / 1000000
          }
        })
      )
))
}});

define({id: "eefdcd0a", mode: "inline", inputs: ["resize","DailyPlot","grantsByDay","display"], body: async (resize,DailyPlot,grantsByDay,display) => {
display(await(
resize((width) =>
        DailyPlot(grantsByDay, {
          width,
          marginRight: 40,
          x: {label: "Fecha"},
          y: {label: "Euros"},
        })
      )
))
}});

define({id: "3487351b", mode: "inline", inputs: ["searchInput","display"], body: async (searchInput,display) => {
display(await(
searchInput
))
}});

define({id: "e7d9e4d0", mode: "inline", inputs: ["grantTableInput","display"], body: async (grantTableInput,display) => {
display(await(
grantTableInput
))
}});

define({id: "70351331", mode: "inline", inputs: ["Display","tableSelection","display"], body: async (Display,tableSelection,display) => {
display(await(
Display.grantSelection(tableSelection)
))
}});

define({id: "a34512ea", mode: "inline", inputs: ["hp","config","display"], body: async (hp,config,display) => {
display(await(
hp.getMonthYearDate(config.build_date)
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div class="row">
  <div class="grid grid-cols-1">
    <h1 style="max-width: 840px">Subvenciones en Euskadi | <small> Desde <observablehq-loading></observablehq-loading><!--:3c93ed0c:--> hasta <observablehq-loading></observablehq-loading><!--:f8b425a7:--></small></h1>
  </div>
</div>
<hr>
<div class="observablehq observablehq--block"><!--:72e644b8:--></div>
<div class="observablehq observablehq--block"><!--:6a57379e:--></div>
<div class="observablehq observablehq--block"><!--:0357b364:--></div>
<div class="observablehq observablehq--block"><!--:7a56f76d:--></div>
<div class="observablehq observablehq--block"><!--:ec6a8080:--></div>
<div class="observablehq observablehq--block"><!--:6709c38e:--></div>
<div class="observablehq observablehq--block"><!--:210898ec:--></div>
<div class="observablehq observablehq--block"><!--:72480863:--></div>
<div class="observablehq observablehq--block"><!--:dfbbdedb:--></div>
<style type="text/css">

#observablehq-footer {
  font-family: "Open Sans", Arial, sans-serif;
}

.card {
  font-family: "Open Sans", Arial, sans-serif;
}

.indicator-number {
  color: #1c4da9;
  font-weight: bold;
  font-size: 2.4em;
}

</style>
<div class="row indicators">
  <div class="grid grid-cols-4">
    <div class="grid-colspan-2" style="grid-auto-rows: auto;">
      <h3 style="color: red">Aplicación en fase de pruebas, algunos datos pueden ser incorrectos</h3> 
      Datos obtenidos de la API de subvenciones concedidas del portal <a href="https://opendata.euskadi.eus/api-granted-benefits/?api=granted-benefit/" target="_blank" rel="noopener noreferrer">Open Data Euskadi</a>.
    </div>
    <div class="card" style="text-align: right;">
      <h2>Cantidad concedida</h2>
      <p class="indicator-number" style="margin-bottom: 10px; margin-bottom: 0px;">
        <observablehq-loading></observablehq-loading><!--:382cd89f:-->
      </p>
      <p class="muted" style="margin-top: 5px;">millones €</p>
    </div>
    <div class="card" style="text-align: right;">
      <h2>Número de subvenciones</h2>
      <p class="indicator-number" style="margin-bottom: 10px; margin-bottom: 0px;">
        <observablehq-loading></observablehq-loading><!--:5c8843bf:-->
      </p>
    </div>
  </div>
</div>
<div class="row charts">
  <div class="grid grid-cols-4">
    <div class="card" style="overflow: auto;">
      <h2>Concesión por Organismo</h2>
      <observablehq-loading></observablehq-loading><!--:83f38939:-->
    </div>
    <div class="card">
      <h2>Concedido por año</h2>
      <observablehq-loading></observablehq-loading><!--:613fcbe3:-->
    </div>
    <div class="card grid-colspan-2">
      <h2>Concedido por día</h2>
      <observablehq-loading></observablehq-loading><!--:eefdcd0a:-->
    </div>
  </div>
</div>
<div class="grid grid-cols-4" style="margin-top: 30px;">
  <div class="card grid-colspan-3">
    <p><observablehq-loading></observablehq-loading><!--:3487351b:--></p>
    <div><observablehq-loading></observablehq-loading><!--:e7d9e4d0:--></div>
  </div>
  <div class="card grid-cols-1" style="grid-auto-rows: auto;"><observablehq-loading></observablehq-loading><!--:70351331:--></div>
</div>
<div class="grid grid-cols-1" style="grid-auto-rows: auto;">
    <row>
      <div style="float: right; text-align: right">
        <p><small>Última actualización: <observablehq-loading></observablehq-loading><!--:a34512ea:--></small></p>
        <span><img src="./_file/assets/images/logo_gisteiz.61380bd7.svg" height="60px"></span>
      </div>
    </row>
</div>
</main>
<footer id="observablehq-footer">
<div><row>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a>. Desarrollado por GISteiz. Si encuentras algún problema o quieres contribuir, puedes hacerlo en <a href="https://github.com/GISteiz/subvenciones-euskadi" target="_blank" rel="noopener noreferrer">GitHub</a>.</row></div>
</footer>
</div>
